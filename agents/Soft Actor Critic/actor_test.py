from t import Actor
from actor import Actor_Net
import numpy as np
import torch

import tensorflow as tf
from tensorflow.math import log,exp,tanh
import tensorflow_probability as tfp
tfd = tfp.distributions

import torch
import torch.nn as nn
import torch.nn.functional as F
from torch.distributions import Normal, MultivariateNormal

np_mu = np.array([[ 0.08947195],
       [-0.04538209],
       [ 0.08796404],
       [ 0.02005046],
       [-0.00601479],
       [ 0.0495842 ],
       [ 0.02669464],
       [ 0.08883949],
       [ 0.44488135],
       [ 0.04179902],
       [-0.06457029],
       [ 0.08603525],
       [ 0.03747291],
       [ 0.01476437],
       [ 0.02234675],
       [ 0.3558061 ],
       [ 0.56131935],
       [ 0.0365719 ],
       [ 0.04036736],
       [ 0.01249269],
       [ 0.07327424],
       [ 0.30347243],
       [ 0.04568441],
       [ 0.01542625],
       [ 0.01224625],
       [ 0.07221302],
       [ 0.02028894],
       [ 0.08684255],
       [ 0.01344506],
       [ 0.02850373],
       [ 0.01045295],
       [ 0.03568186],
       [ 0.07906163],
       [ 0.01116707],
       [ 0.01341893],
       [ 0.0696256 ],
       [-0.01675125],
       [ 0.06465714],
       [ 0.04255616],
       [ 0.01646876],
       [ 0.07950161],
       [ 0.0724896 ],
       [ 0.01030288],
       [ 0.05616153],
       [ 0.08077246],
       [ 0.01330878],
       [ 0.06721248],
       [ 0.05540194],
       [ 0.0886924 ],
       [ 0.03393465],
       [ 0.042929  ],
       [ 0.05561321],
       [-0.04668573],
       [ 0.08978683],
       [ 0.10499926],
       [ 0.0496546 ],
       [ 0.0288957 ],
       [ 0.01628452],
       [ 0.09063174],
       [ 0.0115153 ],
       [ 0.10858559],
       [ 0.02516356],
       [ 0.01199522],
       [-0.06173019],
       [ 0.02268785],
       [ 0.03858532],
       [ 0.01650741],
       [ 0.07508657],
       [ 0.05615325],
       [ 0.03784747],
       [ 0.09046534],
       [ 0.08475664],
       [ 0.06609137],
       [ 0.03542473],
       [ 0.01456708],
       [ 0.0212115 ],
       [ 0.09571996],
       [ 0.04239026],
       [-0.05281474],
       [ 0.05522846],
       [ 0.06744839],
       [-0.060032  ],
       [ 0.01789433],
       [ 0.00571864],
       [ 0.01507828],
       [ 0.01687837],
       [ 0.08785476],
       [ 0.01195747],
       [ 0.06842834],
       [ 0.02823669],
       [ 0.08779509],
       [-0.00852369],
       [ 0.21585669],
       [ 0.12228417],
       [ 0.00901252],
       [ 0.08009542],
       [ 0.04047988],
       [ 0.03475588],
       [ 0.01724996],
       [ 0.06203556],
       [ 0.05524303],
       [ 0.05344148],
       [ 0.00580436],
       [ 0.09973498],
       [ 0.10048579],
       [ 0.01498141],
       [ 0.06833544],
       [ 0.08564933],
       [ 0.5226718 ],
       [ 0.02701934],
       [ 0.07958632],
       [ 0.03577414],
       [ 0.01208273],
       [ 0.03871833],
       [ 0.09190001],
       [ 0.05430266],
       [ 0.10834996],
       [ 0.08693289],
       [ 0.06059698],
       [ 0.05350382],
       [ 0.05985543],
       [ 0.02038012],
       [ 0.1149244 ],
       [ 0.07531239],
       [ 0.08888175],
       [ 0.03859475],
       [ 0.03871809],
       [ 0.03651816],
       [ 0.04853953],
       [ 0.01203978],
       [ 0.09045138],
       [ 0.10544845],
       [ 0.02117434],
       [ 0.0849335 ],
       [ 0.00314413],
       [ 0.11250382],
       [ 0.07749658],
       [ 0.5310828 ],
       [ 0.10381599],
       [ 0.04403577],
       [ 0.01299653],
       [ 0.01195367],
       [ 0.06582466],
       [-0.05357811],
       [ 0.01282351],
       [ 0.04799555],
       [ 0.09144561],
       [ 0.0365397 ],
       [ 0.01322195],
       [ 0.05100625],
       [ 0.09240845],
       [ 0.07595403],
       [ 0.09432449],
       [ 0.0121643 ],
       [ 0.0833812 ],
       [ 0.01427632],
       [ 0.05223834],
       [ 0.07537254],
       [ 0.0463992 ],
       [ 0.51966375],
       [ 0.03891977],
       [ 0.0938078 ],
       [ 0.02609824],
       [ 0.07553435],
       [ 0.05895186],
       [ 0.08308431],
       [ 0.03998482],
       [ 0.01731248],
       [ 0.02848665],
       [ 0.01247352],
       [ 0.19681272],
       [ 0.07307792],
       [ 0.09742525],
       [-0.05935574],
       [ 0.0251777 ],
       [ 0.07299868],
       [ 0.01948285],
       [ 0.02488045],
       [ 0.05777397],
       [ 0.01199428],
       [ 0.02598727],
       [ 0.08235949],
       [ 0.01303318],
       [ 0.09991995],
       [ 0.10934472],
       [ 0.05401434],
       [ 0.41384393],
       [ 0.08578496],
       [ 0.08023071],
       [ 0.04232254],
       [-0.05760457],
       [ 0.02496286],
       [-0.03217106],
       [ 0.12371995],
       [ 0.08135327],
       [ 0.00136213],
       [ 0.01369544],
       [ 0.01243594],
       [ 0.01593087],
       [ 0.37120056],
       [ 0.4632408 ],
       [ 0.07856905],
       [ 0.01647503],
       [-0.01808435],
       [ 0.06451263],
       [ 0.01232673],
       [ 0.1091933 ],
       [ 0.09930757],
       [ 0.01411977],
       [-0.00139949],
       [-0.03304701],
       [ 0.05970393],
       [ 0.13452116],
       [ 0.10620157],
       [ 0.07051738],
       [ 0.08489906],
       [ 0.09997164],
       [ 0.06555394],
       [ 0.02375872],
       [ 0.05720479],
       [ 0.01276919],
       [ 0.03618724],
       [ 0.02710393],
       [ 0.04556412],
       [ 0.01559384],
       [ 0.01159783],
       [-0.03394054],
       [ 0.1005754 ],
       [-0.06572831],
       [ 0.15778315],
       [ 0.01506943],
       [ 0.07267956],
       [ 0.04939933],
       [ 0.10168164],
       [ 0.06767188],
       [ 0.04201932],
       [ 0.07273655],
       [ 0.05689655],
       [ 0.01180523],
       [ 0.05595457],
       [ 0.03487151],
       [ 0.08569328],
       [ 0.02287511],
       [ 0.03171532],
       [ 0.10191396],
       [ 0.05351055],
       [ 0.025579  ],
       [ 0.04237091],
       [ 0.02013854],
       [ 0.07121716],
       [ 0.05699352],
       [ 0.09240271],
       [ 0.2711476 ],
       [ 0.02211559],
       [-0.04464   ],
       [ 0.01811136]], dtype=np.float32)

np_log = np.array([[-0.09714686],
       [ 0.2753327 ],
       [-0.0853141 ],
       [ 0.01406534],
       [ 0.22952875],
       [-0.02469561],
       [ 0.01107184],
       [-0.08497991],
       [-0.26428807],
       [-0.0090672 ],
       [ 0.3444337 ],
       [-0.07467992],
       [ 0.00691348],
       [ 0.04308559],
       [ 0.02251516],
       [-0.30351987],
       [-0.3932806 ],
       [ 0.00928646],
       [-0.00418189],
       [ 0.03015181],
       [-0.06656933],
       [-0.14816621],
       [-0.02985668],
       [ 0.03507483],
       [ 0.03368557],
       [ 0.10511257],
       [ 0.01813151],
       [-0.08645537],
       [ 0.03922985],
       [ 0.22519791],
       [ 0.05576163],
       [-0.00731564],
       [-0.05697156],
       [ 0.04413649],
       [ 0.03938437],
       [-0.04349573],
       [ 0.16353065],
       [-0.03950569],
       [ 0.00581244],
       [ 0.02929308],
       [-0.05846719],
       [ 0.00449659],
       [ 0.054899  ],
       [-0.00231432],
       [-0.06109051],
       [ 0.02948231],
       [-0.05687475],
       [-0.02166417],
       [-0.07649513],
       [ 0.08973853],
       [ 0.00587383],
       [-0.03596596],
       [ 0.27077916],
       [-0.07612922],
       [-0.10547344],
       [-0.03577861],
       [ 0.00770389],
       [ 0.03953945],
       [-0.09033728],
       [ 0.04369549],
       [-0.10579209],
       [ 0.00346786],
       [ 0.0315357 ],
       [ 0.3513464 ],
       [ 0.01068744],
       [ 0.00849583],
       [ 0.03204729],
       [ 0.04966654],
       [-0.00464906],
       [-0.04782427],
       [-0.07530287],
       [-0.06865508],
       [-0.04062587],
       [ 0.01084842],
       [ 0.04451101],
       [ 0.00327081],
       [-0.09298779],
       [ 0.0059891 ],
       [ 0.30692652],
       [-0.02018585],
       [-0.04228983],
       [ 0.33200368],
       [ 0.01668628],
       [ 0.06397753],
       [ 0.13447207],
       [ 0.25249618],
       [-0.08465263],
       [ 0.05287693],
       [ 0.02219125],
       [ 0.00150127],
       [-0.08352181],
       [ 0.27612415],
       [-0.2056615 ],
       [-0.12887573],
       [ 0.04931239],
       [-0.0735727 ],
       [ 0.18692142],
       [ 0.00433243],
       [ 0.03813291],
       [-0.04781543],
       [-0.01457959],
       [-0.00137138],
       [ 0.06203486],
       [-0.09586253],
       [-0.09694023],
       [ 0.04231636],
       [-0.04814114],
       [-0.08600009],
       [-0.38836655],
       [ 0.01331371],
       [-0.05986515],
       [ 0.00208922],
       [ 0.03318016],
       [-0.01403668],
       [-0.09478634],
       [-0.00517684],
       [-0.1189977 ],
       [-0.09026375],
       [-0.04326066],
       [-0.02230409],
       [ 0.13237499],
       [ 0.02865938],
       [-0.05528729],
       [-0.05389633],
       [-0.08703883],
       [ 0.00761689],
       [-0.01073428],
       [ 0.05335993],
       [ 0.00049111],
       [ 0.04206207],
       [-0.08023389],
       [-0.10153484],
       [ 0.00664166],
       [-0.07782357],
       [ 0.17394134],
       [-0.12379683],
       [-0.0536783 ],
       [-0.35514906],
       [-0.10448594],
       [-0.0264511 ],
       [ 0.03085221],
       [ 0.03230302],
       [-0.04044554],
       [ 0.31999406],
       [ 0.04915611],
       [-0.03383956],
       [-0.09514278],
       [ 0.00119042],
       [ 0.03535156],
       [ 0.00249961],
       [-0.08761875],
       [-0.0735246 ],
       [-0.08928163],
       [ 0.0404263 ],
       [ 0.07622075],
       [ 0.04475538],
       [ 0.00277019],
       [-0.07442217],
       [-0.0311122 ],
       [-0.32296392],
       [ 0.00131153],
       [-0.07968634],
       [ 0.01990107],
       [-0.05358835],
       [ 0.00517252],
       [ 0.07248721],
       [-0.00621137],
       [ 0.03217565],
       [ 0.00641219],
       [ 0.03190193],
       [-0.08796243],
       [-0.04743852],
       [-0.09817727],
       [ 0.33001605],
       [ 0.01456581],
       [-0.0707412 ],
       [ 0.03105759],
       [ 0.01907944],
       [-0.0145184 ],
       [ 0.0314123 ],
       [ 0.01879669],
       [-0.0832515 ],
       [ 0.04218393],
       [-0.09789233],
       [-0.08472306],
       [-0.02694379],
       [-0.34463686],
       [-0.07265186],
       [-0.06082246],
       [-0.02237334],
       [ 0.32438368],
       [ 0.0209338 ],
       [ 0.22433868],
       [-0.13183755],
       [-0.06226299],
       [ 0.13432088],
       [ 0.03120813],
       [ 0.03712622],
       [ 0.03625434],
       [-0.20491922],
       [-0.3690394 ],
       [-0.07703813],
       [ 0.02788054],
       [ 0.15885413],
       [-0.04807181],
       [ 0.0212559 ],
       [-0.11928935],
       [-0.0975545 ],
       [ 0.04548918],
       [ 0.13588268],
       [ 0.21504167],
       [-0.04329741],
       [-0.14518455],
       [-0.10639755],
       [-0.06125978],
       [-0.06792993],
       [-0.1081923 ],
       [-0.04169841],
       [ 0.00759685],
       [-0.0274119 ],
       [ 0.02865026],
       [ 0.00798248],
       [ 0.01182361],
       [-0.0291409 ],
       [ 0.0400245 ],
       [ 0.05184828],
       [ 0.28104866],
       [-0.10917998],
       [ 0.35143992],
       [-0.15091273],
       [ 0.02565497],
       [-0.06723537],
       [-0.02157973],
       [-0.11039808],
       [-0.06466733],
       [-0.0017296 ],
       [-0.06958918],
       [-0.02757337],
       [ 0.05070057],
       [-0.02230987],
       [ 0.01137605],
       [-0.09264652],
       [ 0.09892897],
       [ 0.01337804],
       [-0.10956214],
       [-0.00057315],
       [ 0.01972694],
       [ 0.07572611],
       [ 0.01137309],
       [-0.06269009],
       [-0.03014121],
       [-0.08653759],
       [-0.24735188],
       [ 0.00459537],
       [ 0.3341574 ],
       [ 0.03247772]], dtype=np.float32)

torch_mu = torch.from_numpy(np_mu)
torch_log = torch.from_numpy(np_log)

#Tensorflow
epsilon=1e-6
mu, log_std = np_mu,np_log
std = exp(log_std)
e = np.random.normal(0,1)
action = tanh(mu + e * std)
dist = tfd.Normal(loc=mu, scale=std)
log_prob = log(dist.prob(mu + e * std)) - log(1 - action**2 + epsilon)

print(tf.math.reduce_mean(action))

#Pytorch
mu, log_std = torch_mu, torch_log
std = log_std.exp()
dist = Normal(0, 1)
action = torch.tanh(mu + e * std)
log_prob = Normal(mu, std).log_prob(mu + e * std) - torch.log(1 - action.pow(2) + epsilon)

print(action.mean())





